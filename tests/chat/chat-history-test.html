<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat History Test</title>
</head>
<body>
<h2>üìö Chat History Test</h2>

<p style="background:#f9f9f9; border:1px solid #ccc; padding:10px; margin-bottom:10px;">
    <strong>üîç –©–æ —Ç–µ—Å—Ç—É—î —Ü—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞?</strong><br>
    –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ MongoDB –∑–∞ chatId:<br>
    - GET <code>/chat/history/{chatId}</code><br>
    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –¥–∞–Ω—ñ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –∑–±–µ—Ä–µ–∂–µ–Ω—ñ
</p>

<label>Chat ID (telegramId): <input type="text" id="chatId" value="123456"></label><br><br>
<button onclick="loadHistory()">üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é</button>

<pre id="log" style="border:1px solid #ccc; padding:10px; height:300px; overflow-y:scroll;"></pre>

<script>
    function log(message) {
        const logBox = document.getElementById("log");
        logBox.textContent += message + "\n";
        logBox.scrollTop = logBox.scrollHeight;
    }

    async function loadHistory() {
        const chatId = document.getElementById("chatId").value;

        try {
            const response = await fetch("http://localhost:1337/http://localhost:8082/chat/history/" + chatId);
            if (!response.ok) {
                throw new Error("HTTP status " + response.status);
            }

            const messages = await response.json();
            log("‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:");
            messages.forEach(msg => {
                log(`[${msg.timestamp}] ${msg.from} ‚û° ${msg.to}: ${msg.text}`);
            });

        } catch (e) {
            log("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó: " + e);
        }
    }
</script>
</body>
</html>
