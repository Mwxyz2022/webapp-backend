<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>

<p style="background:#f9f9f9; border:1px solid #ccc; padding:10px; margin-bottom:10px;">
    <strong>üîç –©–æ —Ç–µ—Å—Ç—É—î —Ü—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞?</strong><br>
    –¶–µ WebSocket —Ç–µ—Å—Ç –¥–ª—è —á–∞—Ç—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞. –í–∏ –º–æ–∂–µ—Ç–µ:
<ul>
    <li>üì° –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ WebSocket-—Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ <code>/chat/ws</code></li>
    <li>üì§ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ UI –¥–æ WebSocket –±–µ–∫–µ–Ω–¥—É</li>
    <li>üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ MongoDB</li>
    <li>üì• –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞–∑–∞–¥ —É WebSocket —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</li>
    <li>üì¨ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–∞–∫–æ–∂ —É Kafka (topic <code>chat-outgoing</code>)</li>
</ul>
</p>

<h2>üîå Chat WebSocket Test</h2>

<label>Chat ID: <input type="text" id="chatId" value="123456"></label><br>
<label>From (manager): <input type="text" id="from" value="manager-1"></label><br>
<label>To (telegramId): <input type="text" id="to" value="123456789"></label><br>
<label>Text: <input type="text" id="text" value="–ü—Ä–∏–≤—ñ—Ç! –¶–µ WS —Ç–µ—Å—Ç"></label><br><br>

<button onclick="connect()">Connect</button>
<button onclick="sendMessage()">Send</button>

<pre id="log" style="border:1px solid #ccc; padding:10px; height:200px; overflow-y:scroll;"></pre>

<script>
    let stompClient = null;

    function log(message) {
        const logBox = document.getElementById("log");
        logBox.textContent += message + "\n";
        logBox.scrollTop = logBox.scrollHeight;
    }

    function connect() {
        const socket = new SockJS("http://localhost:8082/chat/ws");
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            log("‚úÖ Connected: " + frame);
            const chatId = document.getElementById("chatId").value;
            stompClient.subscribe("/topic/chat." + chatId, function (message) {
                log("üì• Received: " + message.body);
            });
        }, function (error) {
            log("‚ùå Connection error: " + error);
        });
    }

    function sendMessage() {
        const message = {
            chatId: document.getElementById("chatId").value,
            from: document.getElementById("from").value,
            to: document.getElementById("to").value,
            text: document.getElementById("text").value,
            timestamp: null
        };
        stompClient.send("/app/chat", {}, JSON.stringify(message));
        log("üì§ Sent: " + JSON.stringify(message));
    }
</script>
</body>
</html>
